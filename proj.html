<!DOCTYPE>
<html>
	<head>
		<title>Three JS playground</title>
		<style>
			body{
				margin:0;
				overflow:hidden;
			}
		</style>
		<script type="text/javascript" src="three.js-master/build/three.min.js"></script>
		<script src="three.js-master/examples/js/controls/OrbitControls.js"></script>
		<script type="text/javascript" src="three.js-master/examples/js/controls/TrackballControls.js"></script>
	</head>

	<body>
		
	<script>



var Wheel = function(){
	THREE.Group.apply(this, arguments);

	var top = 150;
	var width=15;
	var segments = 15;

	var geometry = new THREE.TorusGeometry( top, width, 5, segments );
	var material = new THREE.MeshStandardMaterial( { 
		color: 0xff0051,
		shading: THREE.FlatShading, 
		metalness: 0,
        roughness: 0.4,
        refractionRatio: 0.25,
        emissive: 0xffd423,
        emissiveIntensity: 0.4 
	});
	var torus = new THREE.Mesh( geometry, material );
	torus.position.z = -200;
	torus.position.y=0;
	torus.position.x=0;	
	torus.receiveShadow = true;
    torus.castShadow = true;
    this.add(torus);
	//this.geometry.center();
   /* var triangleShape = new THREE.Shape();
	triangleShape.moveTo( 80, 20 );
	triangleShape.lineTo( 40, 80 );
	triangleShape.lineTo( 120, 80 );
	triangleShape.lineTo( 80, 20 );

    var extrudeSettings = { amount: 8, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 };
  	addShape( triangleShape, extrudeSettings, 0x8080f0, -180,    0, 0);

  	triangleShape.receiveShadow= true;
  	triangleShape.castShadow = true;
  	this.add(triangleShape);*/

    var pointLight = new THREE.DirectionalLight( 0xffd423,.4);
    pointLight.position.set( 10, 20, 0);
	this.add( pointLight );

	var cz = torus.position.z + 30;

	var cytop = top-20;
	var cybottom = -(top-20);

	var cxright = top-20;
	var cxleft = -(top-20);

	var postx = 45;


	var yconst = 18;

    var cartPositions = [
        [-15, cytop, cz],
        [postx, cytop-yconst+10, cz],
        [(postx*2), cytop-(yconst*2), cz],
        [cxright, cytop-(yconst*4), cz],
        [140, 0, cz],
        [cxright, cybottom+(yconst*4), cz],
        [postx*2, cybottom+(yconst*2)-20, cz],
        [postx, cybottom+(yconst)-30, cz],
       	[-15, -150, cz],

        [-65, cytop-(yconst), cz],
        [-110, cytop-(yconst*2)-10, cz],
        [-140, 20, cz],
        [-cxright-5, cybottom+(yconst*4)+15, cz],
        [-110, cybottom+(yconst*2)+5, cz],
        [-65, cybottom, cz]
    ];

    this.carts = [];

	for (var d =0; d<cartPositions.length; d++){
    	var cart = new Cart();
    	cart.position.set(cartPositions[d][0], cartPositions[d][1], cartPositions[d][2]);
      // cart.rotateX(decorationPositions[d][3]);
      // cart.rotateZ(decorationPositions[d][4]);
        this.add(cart);
        this.carts.push(cart);
    }

    var geometry = new THREE.RingGeometry( 10, 50, 15,1 );
	var material = new THREE.MeshBasicMaterial( { color: 0xFFCCCC,
						 wireframe: true, side: THREE.DoubleSide } );
	var structure = new THREE.Mesh( geometry, material );
	structure.scale.set(3,3,3);
	structure.position.z = -215;
	structure.receiveShadow = true;
    structure.castShadow = true;
	this.add(structure);

}

Wheel.prototype = Object.create(THREE.Group.prototype);
Wheel.prototype.constructor = Wheel;
Wheel.prototype.updatePosition = function() {
	this.rotation.z += 0.01;
	for(var d = 0; d < this.carts.length; d++) {
        this.carts[d].updatePosition();
    }
};


var Cart = function(){
	THREE.Group.apply(this, arguments);
	//var colors = ['#ff0051', '#f56762','#a53c6c','#f19fa0','#72bdbf','#47689b'];

	var geometry1 = new THREE.CylinderGeometry(10, 12, 10, 6, 1);
	var material1 = new THREE.MeshStandardMaterial({
		color: 0xf8db08,
        shading: THREE.FlatShading ,
        metalness: 0,
        roughness: 0.8,
        refractionRatio: 0.25
	});
	var shapeOne = new THREE.Mesh(geometry1, material1);
    shapeOne.position.y += 8;
    shapeOne.castShadow = true;
    shapeOne.receiveShadow = true;
    this.add(shapeOne);

    // A Torus to represent the top hook
    var geometry2 = new THREE.TorusGeometry(7,1,6,4,Math.PI);
    var material2 = new THREE.MeshStandardMaterial({
    	color: 0xf8db08,
        shading: THREE.FlatShading ,
        metalness: 0,
        roughness: 0.8,
        refractionRatio: 0.25
    });
    var shapeTwo = new THREE.Mesh(geometry2,material2);
    shapeTwo.position.y += 13;
    shapeTwo.castShadow = true;
    shapeTwo.receiveShadow = true;
    this.add(shapeTwo);

    this.scale.set(1.5,1.5,1.5);
} 
Cart.prototype = Object.create(THREE.Group.prototype);
Cart.prototype.constructor = Cart;
Cart.prototype.updatePosition = function() {
	this.rotation.z -= 0.01;
	//this.rotation.y +=0.0001;
};


var Iron= function(){
THREE.Group.apply(this, arguments);
var geometry = new THREE.BoxGeometry( 10, 160, 15 );
var material = new THREE.MeshLambertMaterial( {color: 0xFFC2C2} );
var cube = new THREE.Mesh( geometry, material );

cube.rotateZ(-0.40);
cube.position.z=-225;
cube.position.x=-40;
cube.position.y=-60;
cube.receiveShadow= true;
cube.castShadow = true;
this.add(cube);

var geometry = new THREE.BoxGeometry( 10, 160, 15 );
var material = new THREE.MeshLambertMaterial( {color: 0xFFC2C2} );
var cube = new THREE.Mesh( geometry, material );

cube.receiveShadow= true;
cube.castShadow= true;
cube.rotateZ(0.40);
cube.position.z=-225;
cube.position.x=40;
cube.position.y=-60;
this.add(cube);

var theta = 0.1;
var radius =30;
var pts=[];

var extrudeSettings = {
	steps: 1,
	amount: 18,
	bevelEnabled: true,
	bevelThickness: 1,
	bevelSize: 1,
	bevelSegments: 1};

for(var i =0; i< 70; i++){
	theta+=0.1;
	pts.push( new THREE.Vector2 ( radius * Math.cos( theta ), radius * Math.sin( theta)  ) );
}

var shape = new THREE.Shape( pts );
var geometry = new THREE.ExtrudeGeometry( shape, extrudeSettings );
var texture = new THREE.TextureLoader().load( 'textures/mickey.png' );

texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
texture.repeat.set( 0.04, 0.04 );

var material2 = new THREE.MeshBasicMaterial( { map: texture, wireframe: false } );
var mesh = new THREE.Mesh( geometry, material2 );
//mesh.scale.set(5,5,5);
mesh.position.z-=220;
this.add(mesh);

};
Iron.prototype = Object.create(THREE.Group.prototype);
Iron.prototype.constructor = Iron;


var scene = new THREE.Scene();

var camera = new THREE.PerspectiveCamera(
    70,                                   // Field of view
    window.innerWidth/window.innerHeight, // Aspect ratio
    0.1,                                  // Near clipping pane
    1000                                  // Far clipping pane
);

camera.position.set(0,250,600);

camera.lookAt(new THREE.Vector3(0,0,0));

var renderer = new THREE.WebGLRenderer({ antialias: true });

renderer.setSize( window.innerWidth, window.innerHeight );

renderer.setClearColor( 0xfff6e6 );

renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

document.body.appendChild( renderer.domElement );

var ambientLight = new THREE.AmbientLight( 0xffffff, 0.3 );
scene.add( ambientLight );

var pointLight = new THREE.PointLight( 0xffffff,.8 );
pointLight.position.set( 0, 120, 100 );
pointLight.castShadow = true;
pointLight.shadow.mapSize.width = 1024;
pointLight.shadow.mapSize.height = 1024;
scene.add( pointLight );

var shadowMaterial = new THREE.ShadowMaterial( { color: 0xdcdcdc } );
shadowMaterial.opacity = 0.5;
var groundMesh = new THREE.Mesh(
    new THREE.BoxGeometry( 1200, .1, 1200 ),
    shadowMaterial
);
groundMesh.receiveShadow = true;
scene.add( groundMesh );

var controls = new THREE.OrbitControls( camera, renderer.domElement );
controls.target = new THREE.Vector3(0,80,0);
controls.maxPolarAngle = Math.PI / 2;
controls.minDistance = 100;
controls.maxDistance = 220;

var wheel = new Wheel();
var iron = new Iron();
scene.add(iron);

//var group = new THREE.Group();
//group.add( wheel );
//group.add( cart );
//scene.add( group );

scene.add(wheel);

requestAnimationFrame(render);
function render() {
    controls.update();
	wheel.updatePosition();

    renderer.render(scene, camera);
    requestAnimationFrame(render);
}
	</script>
	</body>
</html>